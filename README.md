# Birthday Pizza Bot

Telegram-бот на Grammy JS: читает Excel/CSV, проверяет дни рождения и сообщает вероятность пиццы.

## Как работает бот

- При старте читает `BIRTHDAYS_FILE` и сохраняет список.
- По команде `/today` перечитывает файл и отвечает, есть ли именинники сегодня.
- По команде `/checkid` отвечает ID и имя пользователя (из Telegram-профиля).
- По расписанию один раз в сутки проверяет завтрашнюю дату и, если есть именинники, отправляет сообщение в `CHAT_ID`.

## Быстрый старт

1) Установите зависимости.
2) Скопируйте `.env.example` в `.env` и заполните `BOT_TOKEN`, `CHAT_ID`.
3) Запустите проверку или бота.

## Команды

- Проверка в консоли: `npm run check`
- Отправка в чат один раз: `npm run notify`
- Запуск бота: `npm start`

## Формат данных

Файл `data/birthdays.csv` или `.xlsx` с колонками:

- `name` — имя
- `birthday` — дата в формате `YYYY-MM-DD`
- `chance` — yes/no/maybe (или другое значение)
- `comment` — необязательно

## Ежедневные уведомления (встроенное расписание)

Бот сам планирует следующий запуск проверки, без внешнего cron:

1. Берет время из `DAILY_CHECK_TIME` (формат `HH:MM`, локальное время).
2. Считает, сколько миллисекунд до ближайшего наступления этого времени.
3. Ставит `setTimeout` на вычисленную задержку.
4. Когда таймер сработал, проверяет **завтрашнюю** дату и, если есть именинники, отправляет сообщение в `CHAT_ID`.
5. Сразу после проверки планирует следующую проверку (следующий день).

Дополнительные правила:

- Если завтра именинников нет и это не первый понедельник месяца, сообщение не отправляется.
- По пятницам бот проверяет сразу субботу и воскресенье, чтобы сообщить о выходных днях рождения заранее.
- Пицца-понедельник: каждый первый понедельник месяца бот добавляет отдельную строку в уведомление.

Если бот перезапустится, он заново рассчитает ближайшее время и продолжит ежедневные проверки.
Если `CHAT_ID` не указан, ежедневные уведомления отключены.

## Примечания

- Файл задается переменной `BIRTHDAYS_FILE`.
